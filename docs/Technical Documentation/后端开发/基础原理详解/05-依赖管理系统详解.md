# ä¾èµ–ç®¡ç†ç³»ç»Ÿè¯¦è§£

## æ¦‚è¿°

ä¾èµ–ç®¡ç†æ˜¯Pythonåç«¯å¼€å‘ä¸­çš„æ ¸å¿ƒç¯èŠ‚ï¼Œå®ƒå†³å®šäº†é¡¹ç›®çš„ç¨³å®šæ€§ã€å¯ç»´æŠ¤æ€§å’Œéƒ¨ç½²æ•ˆç‡ã€‚æœ¬æ–‡å°†æ·±å…¥è§£æPythonä¾èµ–ç®¡ç†ç³»ç»Ÿçš„å·¥ä½œåŸç†ï¼Œä»¥äººåŠ›èµ„æºè°ƒåº¦ç³»ç»Ÿä¸ºä¾‹ï¼Œè¯¦ç»†è¯´æ˜å¦‚ä½•æ„å»ºä¸“ä¸šçš„ä¾èµ–ç®¡ç†ä½“ç³»ã€‚

## requirements.txtçš„è®¾è®¡åŸç†

### ä¸ºä»€ä¹ˆéœ€è¦requirements.txtï¼Ÿ

åœ¨Pythoné¡¹ç›®å¼€å‘ä¸­ï¼Œæˆ‘ä»¬ä¼šä½¿ç”¨å¤§é‡ç¬¬ä¸‰æ–¹åº“ã€‚å¦‚æœæ²¡æœ‰ç»Ÿä¸€çš„ä¾èµ–ç®¡ç†æœºåˆ¶ï¼Œä¼šé¢ä¸´ä»¥ä¸‹é—®é¢˜ï¼š

```
é—®é¢˜åœºæ™¯ï¼š
å¼€å‘è€…Açš„ç¯å¢ƒï¼šFastAPI 0.104.1, SQLAlchemy 2.0.21
å¼€å‘è€…Bçš„ç¯å¢ƒï¼šFastAPI 0.103.2, SQLAlchemy 1.4.48
ç”Ÿäº§ç¯å¢ƒï¼šFastAPI 0.100.0, SQLAlchemy 1.4.35

ç»“æœï¼š
1. åŠŸèƒ½å·®å¼‚ï¼šä¸åŒç‰ˆæœ¬APIå¯èƒ½ä¸å…¼å®¹
2. Bugè¡¨ç°ï¼šåŒæ ·ä»£ç åœ¨ä¸åŒç¯å¢ƒè¡¨ç°ä¸ä¸€è‡´
3. éƒ¨ç½²é£é™©ï¼šç”Ÿäº§ç¯å¢ƒå¯èƒ½ç¼ºå°‘å…³é”®ä¾èµ–
4. è°ƒè¯•å›°éš¾ï¼šæ— æ³•ç¡®å®šé—®é¢˜æ˜¯ä»£ç è¿˜æ˜¯ç¯å¢ƒå¯¼è‡´
```

requirements.txtè§£å†³äº†è¿™äº›é—®é¢˜ï¼š

```txt
# requirements.txt - ä¾èµ–æ¸…å•æ–‡ä»¶
# ä¸ºä»€ä¹ˆè¦ç²¾ç¡®æŒ‡å®šç‰ˆæœ¬ï¼Ÿ
fastapi==0.104.1          # ç¡®ä¿æ‰€æœ‰ç¯å¢ƒä½¿ç”¨ç›¸åŒç‰ˆæœ¬
SQLAlchemy==2.0.21        # é¿å…APIå˜æ›´å¯¼æ€çš„é—®é¢˜
uvicorn==0.24.0           # ASGIæœåŠ¡å™¨ç‰ˆæœ¬ä¸€è‡´
alembic==1.12.1           # æ•°æ®åº“è¿ç§»å·¥å…·ç‰ˆæœ¬ä¸€è‡´
python-jose[cryptography]==3.3.0  # JWTè®¤è¯åº“ç‰ˆæœ¬é”å®š
psycopg2-binary==2.9.7    # PostgreSQLé©±åŠ¨ç‰ˆæœ¬å›ºå®š
redis==4.6.0              # Rediså®¢æˆ·ç«¯ç‰ˆæœ¬ç¡®å®š
python-dotenv==1.0.0      # ç¯å¢ƒå˜é‡ç®¡ç†å·¥å…·

# ä¸ºä»€ä¹ˆè¦åŒ…å«é—´æ¥ä¾èµ–ï¼Ÿ
starlette==0.27.0         # FastAPIçš„åº•å±‚ASGIæ¡†æ¶
pydantic==2.5.0           # æ•°æ®éªŒè¯å’Œåºåˆ—åŒ–
anyio==3.7.1              # å¼‚æ­¥I/Oåº“
sniffio==1.3.0            # å¼‚æ­¥åº“æ£€æµ‹å·¥å…·
```

### requirements.txtçš„ç‰ˆæœ¬æ§åˆ¶è¯­æ³•

#### 1. ç²¾ç¡®ç‰ˆæœ¬æ§åˆ¶
```txt
# ç²¾ç¡®ç‰ˆæœ¬ - ç”¨äºæ ¸å¿ƒæ¡†æ¶å’Œå…³é”®åº“
fastapi==0.104.1
# ä¼˜ç‚¹ï¼šå®Œå…¨å¯é¢„æµ‹ï¼Œç¯å¢ƒä¸€è‡´æ€§æœ€é«˜
# ç¼ºç‚¹ï¼šæ— æ³•è‡ªåŠ¨è·å¾—å®‰å…¨æ›´æ–°å’Œbugä¿®å¤
# é€‚ç”¨ï¼šç”Ÿäº§ç¯å¢ƒçš„æ ¸å¿ƒä¾èµ–

# ä¸ºä»€ä¹ˆFastAPIè¦ä½¿ç”¨ç²¾ç¡®ç‰ˆæœ¬ï¼Ÿ
# 1. APIç¨³å®šæ€§ï¼šé¿å…ç‰ˆæœ¬å‡çº§å¯¼è‡´çš„APIå˜æ›´
# 2. è¡Œä¸ºä¸€è‡´ï¼šç¡®ä¿æ‰€æœ‰ç¯å¢ƒçš„FastAPIè¡Œä¸ºå®Œå…¨ä¸€è‡´
# 3. è°ƒè¯•ä¾¿åˆ©ï¼šé—®é¢˜å¤ç°æ›´å®¹æ˜“
```

#### 2. å…¼å®¹ç‰ˆæœ¬æ§åˆ¶
```txt
# å…¼å®¹ç‰ˆæœ¬ - å…è®¸è¡¥ä¸çº§åˆ«æ›´æ–°
requests~=2.31.0
# ç­‰ä»·äºï¼šrequests>=2.31.0,<2.32.0
# ä¼˜ç‚¹ï¼šè‡ªåŠ¨è·å¾—å®‰å…¨æ›´æ–°å’Œbugä¿®å¤
# ç¼ºç‚¹ï¼šå¯èƒ½å¼•å…¥å¾®å°çš„è¡Œä¸ºå˜åŒ–
# é€‚ç”¨ï¼šæˆç†Ÿç¨³å®šçš„å·¥å…·åº“

# ä¸ºä»€ä¹ˆrequestså¯ä»¥ä½¿ç”¨å…¼å®¹ç‰ˆæœ¬ï¼Ÿ
# 1. APIç¨³å®šï¼šrequestsçš„APIéå¸¸ç¨³å®š
# 2. å®‰å…¨é‡è¦ï¼šHTTPåº“éœ€è¦åŠæ—¶çš„å®‰å…¨æ›´æ–°
# 3. å‘åå…¼å®¹ï¼šè¡¥ä¸ç‰ˆæœ¬é€šå¸¸ä¿æŒå‘åå…¼å®¹
```

#### 3. èŒƒå›´ç‰ˆæœ¬æ§åˆ¶
```txt
# èŒƒå›´ç‰ˆæœ¬ - å…è®¸æ¬¡ç‰ˆæœ¬æ›´æ–°
SQLAlchemy>=2.0.0,<3.0.0
# ä¼˜ç‚¹ï¼šè·å¾—æ–°åŠŸèƒ½å’Œæ€§èƒ½æ”¹è¿›
# ç¼ºç‚¹ï¼šå¯èƒ½å¼•å…¥ä¸å…¼å®¹çš„å˜æ›´
# é€‚ç”¨ï¼šå¿«é€Ÿå‘å±•çš„åº“ï¼Œéœ€è¦æ–°åŠŸèƒ½

# ä¸ºä»€ä¹ˆSQLAlchemyä½¿ç”¨èŒƒå›´ç‰ˆæœ¬ï¼Ÿ
# 1. åŠŸèƒ½ä¸°å¯Œï¼š2.xç‰ˆæœ¬æŒç»­å¢åŠ æ–°åŠŸèƒ½
# 2. æ€§èƒ½ä¼˜åŒ–ï¼šæ–°ç‰ˆæœ¬é€šå¸¸æœ‰æ€§èƒ½æ”¹è¿›
# 3. ä¸»ç‰ˆæœ¬ç¨³å®šï¼š2.xå†…éƒ¨APIç›¸å¯¹ç¨³å®š
```

#### 4. æœ€å°ç‰ˆæœ¬æ§åˆ¶
```txt
# æœ€å°ç‰ˆæœ¬ - ç¡®ä¿å®‰å…¨æ€§
cryptography>=41.0.0
# ä¼˜ç‚¹ï¼šç¡®ä¿å®‰å…¨æ¼æ´å·²ä¿®å¤
# ç¼ºç‚¹ï¼šå¯èƒ½å¼•å…¥ä¸å…¼å®¹çš„å˜æ›´
# é€‚ç”¨ï¼šå®‰å…¨ç›¸å…³çš„åº“

# ä¸ºä»€ä¹ˆcryptographyä½¿ç”¨æœ€å°ç‰ˆæœ¬ï¼Ÿ
# 1. å®‰å…¨å…³é”®ï¼šåŠ å¯†åº“çš„å®‰å…¨æ¼æ´å½±å“ä¸¥é‡
# 2. å¿«é€Ÿä¿®å¤ï¼šå®‰å…¨é—®é¢˜éœ€è¦å¿«é€Ÿä¿®å¤
# 3. å‘åå…¼å®¹ï¼šé€šå¸¸ä¿æŒAPIå…¼å®¹æ€§
```

### æ³¨é‡Šå’Œæ–‡æ¡£åŒ–

```txt
# requirements.txt - äººåŠ›èµ„æºè°ƒåº¦ç³»ç»Ÿä¾èµ–æ¸…å•
# é¡¹ç›®ï¼šHR Scheduling System
# Pythonç‰ˆæœ¬ï¼š3.11+
# æ›´æ–°æ—¥æœŸï¼š2024-01-15

# ============================================================================
# æ ¸å¿ƒæ¡†æ¶ - ä½¿ç”¨ç²¾ç¡®ç‰ˆæœ¬ç¡®ä¿ç¨³å®šæ€§
# ============================================================================
fastapi==0.104.1          # Webæ¡†æ¶ï¼Œæä¾›HTTPæœåŠ¡å’Œè·¯ç”±
uvicorn==0.24.0           # ASGIæœåŠ¡å™¨ï¼ŒFastAPIçš„è¿è¡Œç¯å¢ƒ
starlette==0.27.0         # ASGIæ¡†æ¶ï¼ŒFastAPIçš„åº•å±‚ä¾èµ–
pydantic==2.5.0           # æ•°æ®éªŒè¯å’Œåºåˆ—åŒ–åº“

# ============================================================================
# æ•°æ®åº“ç›¸å…³ - ORMå’Œæ•°æ®åº“é©±åŠ¨
# ============================================================================
SQLAlchemy==2.0.21        # ORMæ¡†æ¶ï¼Œæ•°æ®åº“æŠ½è±¡å±‚
alembic==1.12.1           # æ•°æ®åº“è¿ç§»å·¥å…·
psycopg2-binary==2.9.7    # PostgreSQLæ•°æ®åº“é©±åŠ¨ï¼ˆäºŒè¿›åˆ¶ç‰ˆæœ¬ï¼‰

# ä¸ºä»€ä¹ˆé€‰æ‹©psycopg2-binaryè€Œä¸æ˜¯psycopg2ï¼Ÿ
# 1. å®‰è£…ç®€å•ï¼šä¸éœ€è¦ç¼–è¯‘ï¼ŒåŒ…å«é¢„ç¼–è¯‘çš„äºŒè¿›åˆ¶æ–‡ä»¶
# 2. ä¾èµ–å°‘ï¼šä¸éœ€è¦PostgreSQLå¼€å‘å¤´æ–‡ä»¶
# 3. æ€§èƒ½ç›¸åŒï¼šè¿è¡Œæ—¶æ€§èƒ½ä¸æºç ç¼–è¯‘ç‰ˆæœ¬ç›¸åŒ
# æ³¨æ„ï¼šç”Ÿäº§ç¯å¢ƒå»ºè®®ä½¿ç”¨psycopg2ä»¥è·å¾—æœ€ä½³æ€§èƒ½

# ============================================================================
# è®¤è¯å’Œå®‰å…¨ - JWTå’Œå¯†ç å¤„ç†
# ============================================================================
python-jose[cryptography]==3.3.0  # JWTè®¤è¯åº“ï¼Œæ”¯æŒè®¿é—®ä»¤ç‰Œå’Œåˆ·æ–°ä»¤ç‰Œ
passlib[bcrypt]==1.7.4     # å¯†ç å“ˆå¸Œåº“ï¼Œå®‰å…¨çš„å¯†ç å­˜å‚¨
python-multipart==0.0.6   # è¡¨å•æ•°æ®è§£æï¼Œæ”¯æŒæ–‡ä»¶ä¸Šä¼ 

# ============================================================================
# ç¼“å­˜å’Œä¼šè¯ - Redisé›†æˆ
# ============================================================================
redis==4.6.0              # Rediså®¢æˆ·ç«¯ï¼Œç”¨äºç¼“å­˜å’Œä¼šè¯å­˜å‚¨
aioredis==2.0.1           # å¼‚æ­¥Rediså®¢æˆ·ç«¯ï¼Œæ”¯æŒFastAPIå¼‚æ­¥æ“ä½œ

# ============================================================================
# é…ç½®å’Œç¯å¢ƒ - ç¯å¢ƒå˜é‡å’Œé…ç½®ç®¡ç†
# ============================================================================
python-dotenv==1.0.0      # ç¯å¢ƒå˜é‡åŠ è½½ï¼Œæ”¯æŒ.envæ–‡ä»¶

# ============================================================================
# æ•°æ®éªŒè¯å’Œåºåˆ—åŒ– - APIæ•°æ®å¤„ç†
# ============================================================================
pydantic==2.5.0           # æ•°æ®éªŒè¯å’Œåºåˆ—åŒ–åº“ï¼ˆå·²åœ¨æ ¸å¿ƒæ¡†æ¶ä¸­åŒ…å«ï¼‰
pydantic-settings==2.1.0  # Pydanticé…ç½®ç®¡ç†
email-validator==2.1.0    # é‚®ç®±éªŒè¯æ”¯æŒ

# ============================================================================
# HTTPå’Œç½‘ç»œ - å¤–éƒ¨APIè°ƒç”¨
# ============================================================================
requests~=2.31.0          # HTTPå®¢æˆ·ç«¯åº“ï¼Œç”¨äºè°ƒç”¨å¤–éƒ¨API
urllib3>=1.26.0,<3.0.0   # HTTPåº“ï¼Œrequestsçš„åº•å±‚ä¾èµ–

# ============================================================================
# æ—¥æœŸå’Œæ—¶é—´ - æ—¶é—´å¤„ç†å·¥å…·
# ============================================================================
pytz==2023.3              # æ—¶åŒºå¤„ç†åº“ï¼Œå¤„ç†å…¨çƒæ—¶åŒº
python-dateutil==2.8.2    # æ—¥æœŸè§£æå’Œè®¡ç®—å·¥å…·

# ============================================================================
# å·¥å…·åº“ - é€šç”¨å·¥å…·å’Œè¾…åŠ©å‡½æ•°
# ============================================================================
click==8.1.7              # å‘½ä»¤è¡Œå·¥å…·åº“ï¼ŒFlask CLIçš„åŸºç¡€
colorama==0.4.6           # ç»ˆç«¯é¢œè‰²è¾“å‡ºï¼Œæ”¹å–„CLIä½“éªŒ
```

## åˆ†å±‚ä¾èµ–ç®¡ç†

### ä¸ºä»€ä¹ˆéœ€è¦åˆ†å±‚ç®¡ç†ï¼Ÿ

ä¸åŒç¯å¢ƒå¯¹ä¾èµ–çš„éœ€æ±‚ä¸åŒï¼š

```
ç¯å¢ƒéœ€æ±‚åˆ†æï¼š

å¼€å‘ç¯å¢ƒéœ€è¦ï¼š
â”œâ”€â”€ åŸºç¡€è¿è¡Œä¾èµ–ï¼ˆFlask, SQLAlchemyç­‰ï¼‰
â”œâ”€â”€ è°ƒè¯•å·¥å…·ï¼ˆFlask-DebugToolbar, IPythonç­‰ï¼‰
â”œâ”€â”€ ä»£ç è´¨é‡å·¥å…·ï¼ˆflake8, blackç­‰ï¼‰
â”œâ”€â”€ æµ‹è¯•æ¡†æ¶ï¼ˆpytest, coverageç­‰ï¼‰
â””â”€â”€ å¼€å‘ä¾¿åˆ©å·¥å…·ï¼ˆçƒ­é‡è½½, è¯¦ç»†æ—¥å¿—ç­‰ï¼‰

æµ‹è¯•ç¯å¢ƒéœ€è¦ï¼š
â”œâ”€â”€ åŸºç¡€è¿è¡Œä¾èµ–
â”œâ”€â”€ æµ‹è¯•æ¡†æ¶å’Œå·¥å…·
â”œâ”€â”€ æµ‹è¯•æ•°æ®ç”Ÿæˆï¼ˆfactory-boyç­‰ï¼‰
â”œâ”€â”€ è¦†ç›–ç‡æŠ¥å‘Šå·¥å…·
â””â”€â”€ æ¨¡æ‹Ÿå’Œå­˜æ ¹åº“ï¼ˆresponses, mockç­‰ï¼‰

ç”Ÿäº§ç¯å¢ƒéœ€è¦ï¼š
â”œâ”€â”€ åŸºç¡€è¿è¡Œä¾èµ–
â”œâ”€â”€ ç”Ÿäº§æœåŠ¡å™¨ï¼ˆuvicorn, gunicornç­‰ï¼‰
â”œâ”€â”€ ç›‘æ§å’Œæ—¥å¿—ï¼ˆprometheus-clientç­‰ï¼‰
â”œâ”€â”€ æ€§èƒ½ä¼˜åŒ–å·¥å…·
â””â”€â”€ å®‰å…¨å¢å¼ºåº“
```

### åˆ†å±‚ä¾èµ–ç»“æ„è®¾è®¡

```
requirements/
â”œâ”€â”€ base.txt              # æ‰€æœ‰ç¯å¢ƒçš„åŸºç¡€ä¾èµ–
â”œâ”€â”€ development.txt       # å¼€å‘ç¯å¢ƒä¸“ç”¨ä¾èµ–
â”œâ”€â”€ testing.txt          # æµ‹è¯•ç¯å¢ƒä¸“ç”¨ä¾èµ–
â”œâ”€â”€ production.txt       # ç”Ÿäº§ç¯å¢ƒä¸“ç”¨ä¾èµ–
â””â”€â”€ optional.txt         # å¯é€‰åŠŸèƒ½ä¾èµ–
```

#### 1. åŸºç¡€ä¾èµ– (base.txt)

```txt
# requirements/base.txt
# æ‰€æœ‰ç¯å¢ƒéƒ½éœ€è¦çš„æ ¸å¿ƒä¾èµ–
# è¿™äº›æ˜¯åº”ç”¨è¿è¡Œçš„æœ€å°ä¾èµ–é›†åˆ

# ============================================================================
# Webæ¡†æ¶æ ¸å¿ƒ
# ============================================================================
fastapi==0.104.1
uvicorn==0.24.0
starlette==0.27.0
pydantic==2.5.0
anyio==3.7.1

# ============================================================================
# æ•°æ®åº“ORM
# ============================================================================
SQLAlchemy==2.0.21
alembic==1.12.1

# ============================================================================
# æ•°æ®åº“é©±åŠ¨
# ============================================================================
psycopg2-binary==2.9.7    # PostgreSQLï¼ˆå¼€å‘å’Œæµ‹è¯•ï¼‰
# æ³¨æ„ï¼šç”Ÿäº§ç¯å¢ƒå»ºè®®ä½¿ç”¨psycopg2æ›¿ä»£psycopg2-binary

# ============================================================================
# è®¤è¯å’Œå®‰å…¨
# ============================================================================
python-jose[cryptography]==3.3.0
passlib[bcrypt]==1.7.4
python-multipart==0.0.6

# ============================================================================
# ç¼“å­˜å’Œä¼šè¯
# ============================================================================
redis==4.6.0
aioredis==2.0.1

# ============================================================================
# æ•°æ®éªŒè¯å’Œåºåˆ—åŒ–
# ============================================================================
pydantic==2.5.0
pydantic-settings==2.1.0
email-validator==2.1.0

# ============================================================================
# é…ç½®ç®¡ç†
# ============================================================================
python-dotenv==1.0.0

# ============================================================================
# HTTPå®¢æˆ·ç«¯
# ============================================================================
requests~=2.31.0

# ============================================================================
# æ—¶é—´å¤„ç†
# ============================================================================
pytz==2023.3
python-dateutil==2.8.2

# ============================================================================
# å·¥å…·åº“
# ============================================================================
colorama==0.4.6           # ç»ˆç«¯é¢œè‰²æ”¯æŒ
```

#### 2. å¼€å‘ç¯å¢ƒä¾èµ– (development.txt)

```txt
# requirements/development.txt
# å¼€å‘ç¯å¢ƒä¸“ç”¨ä¾èµ–
# åŒ…å«è°ƒè¯•ã€ä»£ç è´¨é‡ã€å¼€å‘ä¾¿åˆ©å·¥å…·

# ç»§æ‰¿åŸºç¡€ä¾èµ–
-r base.txt

# ============================================================================
# è°ƒè¯•å’Œå¼€å‘å·¥å…·
# ============================================================================
fastapi-profiler==1.2.0    # FastAPIæ€§èƒ½åˆ†æå·¥å…·
# åŠŸèƒ½ï¼šè¯·æ±‚æ€§èƒ½åˆ†æã€SQLæŸ¥è¯¢ç»Ÿè®¡ã€å†…å­˜ä½¿ç”¨ç›‘æ§
# ä¸ºä»€ä¹ˆéœ€è¦ï¼šå¼€å‘æ—¶å¿«é€Ÿå®šä½æ€§èƒ½é—®é¢˜å’Œè°ƒè¯•ä¿¡æ¯

ipython==8.15.0             # å¢å¼ºçš„Pythonäº¤äº’å¼shell
# åŠŸèƒ½ï¼šè¯­æ³•é«˜äº®ã€è‡ªåŠ¨è¡¥å…¨ã€é­”æ³•å‘½ä»¤ã€å†å²è®°å½•
# ä¸ºä»€ä¹ˆéœ€è¦ï¼šæé«˜å¼€å‘æ•ˆç‡ï¼Œä¾¿äºè°ƒè¯•å’Œå®éªŒ

ipdb==0.13.13               # IPythonè°ƒè¯•å™¨
# åŠŸèƒ½ï¼šæ–­ç‚¹è°ƒè¯•ã€å˜é‡æ£€æŸ¥ã€ä»£ç æ‰§è¡Œ
# ä¸ºä»€ä¹ˆéœ€è¦ï¼šå¤æ‚é€»è¾‘è°ƒè¯•ï¼Œæ¯”printè°ƒè¯•æ›´é«˜æ•ˆ

# ============================================================================
# ä»£ç è´¨é‡å·¥å…·
# ============================================================================
flake8==6.0.0               # ä»£ç é£æ ¼æ£€æŸ¥
# æ£€æŸ¥ï¼šPEP8è§„èŒƒã€è¯­æ³•é”™è¯¯ã€æœªä½¿ç”¨å˜é‡ã€å¤æ‚åº¦
# é…ç½®æ–‡ä»¶ï¼š.flake8 æˆ– setup.cfg

black==23.7.0               # ä»£ç è‡ªåŠ¨æ ¼å¼åŒ–
# åŠŸèƒ½ï¼šç»Ÿä¸€ä»£ç é£æ ¼ã€è‡ªåŠ¨æ ¼å¼åŒ–ã€é›†æˆIDE
# ä¸ºä»€ä¹ˆé€‰æ‹©blackï¼šæ— é…ç½®ã€ä¸€è‡´æ€§å¥½ã€ç¤¾åŒºè®¤å¯åº¦é«˜

isort==5.12.0               # å¯¼å…¥è¯­å¥æ’åº
# åŠŸèƒ½ï¼šæŒ‰è§„åˆ™æ’åºimportè¯­å¥ã€ç§»é™¤é‡å¤å¯¼å…¥
# é…ç½®ï¼šä¸blackå…¼å®¹çš„é…ç½®

mypy==1.5.1                 # é™æ€ç±»å‹æ£€æŸ¥
# åŠŸèƒ½ï¼šç±»å‹æ³¨è§£æ£€æŸ¥ã€ç±»å‹æ¨æ–­ã€IDEé›†æˆ
# ä¸ºä»€ä¹ˆéœ€è¦ï¼šæå‰å‘ç°ç±»å‹ç›¸å…³é”™è¯¯ï¼Œæé«˜ä»£ç è´¨é‡

# ============================================================================
# æµ‹è¯•æ¡†æ¶ï¼ˆå¼€å‘æ—¶ä¹Ÿéœ€è¦è¿è¡Œæµ‹è¯•ï¼‰
# ============================================================================
pytest==7.4.2              # æµ‹è¯•æ¡†æ¶
pytest-asyncio==0.21.1     # å¼‚æ­¥æµ‹è¯•æ”¯æŒ
pytest-cov==4.1.0          # æµ‹è¯•è¦†ç›–ç‡
pytest-mock==3.11.1        # æ¨¡æ‹Ÿå¯¹è±¡æ”¯æŒ
httpx==0.25.2              # å¼‚æ­¥HTTPå®¢æˆ·ç«¯ï¼Œç”¨äºAPIæµ‹è¯•

# ============================================================================
# å¼€å‘æœåŠ¡å™¨å’Œçƒ­é‡è½½
# ============================================================================
watchdog==3.0.0            # æ–‡ä»¶ç³»ç»Ÿç›‘æ§
# åŠŸèƒ½ï¼šç›‘æ§æ–‡ä»¶å˜åŒ–ã€è§¦å‘é‡è½½ã€æ”¯æŒå¤šå¹³å°
# ä¸ºä»€ä¹ˆéœ€è¦ï¼šè‡ªåŠ¨é‡å¯å¼€å‘æœåŠ¡å™¨ï¼Œæé«˜å¼€å‘æ•ˆç‡

# ============================================================================
# APIæ–‡æ¡£ç”Ÿæˆ
# ============================================================================
# FastAPIå†…ç½®OpenAPIæ–‡æ¡£ç”Ÿæˆï¼Œæ— éœ€é¢å¤–ä¾èµ–
# åŠŸèƒ½ï¼šè‡ªåŠ¨ç”ŸæˆAPIæ–‡æ¡£ã€äº¤äº’å¼æµ‹è¯•ç•Œé¢ï¼ˆSwagger UIå’ŒReDocï¼‰
# ä¸ºä»€ä¹ˆä¸éœ€è¦é¢å¤–åº“ï¼šFastAPIå†…ç½®æ”¯æŒï¼Œè‡ªåŠ¨ç”ŸæˆOpenAPIè§„èŒƒ

# ============================================================================
# æ•°æ®åº“ç®¡ç†å·¥å…·
# ============================================================================
sqladmin==0.16.0           # FastAPIç®¡ç†åå°
# åŠŸèƒ½ï¼šæ•°æ®åº“ç®¡ç†ç•Œé¢ã€CRUDæ“ä½œã€æƒé™æ§åˆ¶
# ä¸ºä»€ä¹ˆéœ€è¦ï¼šå¼€å‘æ—¶å¿«é€ŸæŸ¥çœ‹å’Œä¿®æ”¹æ•°æ®

# ============================================================================
# æ€§èƒ½åˆ†æ
# ============================================================================
# å·²åœ¨è°ƒè¯•å·¥å…·ä¸­åŒ…å«fastapi-profiler
# é¢å¤–çš„æ€§èƒ½ç›‘æ§å·¥å…·
prometheus-client==0.19.0  # PrometheusæŒ‡æ ‡æ”¶é›†
# åŠŸèƒ½ï¼šåº”ç”¨æŒ‡æ ‡å¯¼å‡ºã€æ€§èƒ½ç›‘æ§ã€ç”Ÿäº§ç¯å¢ƒç›‘æ§
# ä¸ºä»€ä¹ˆéœ€è¦ï¼šç”Ÿäº§çº§æ€§èƒ½ç›‘æ§å’ŒæŒ‡æ ‡æ”¶é›†

# ============================================================================
# ç¯å¢ƒå’Œé…ç½®å·¥å…·
# ============================================================================
python-decouple==3.8       # é…ç½®ç®¡ç†å¢å¼º
# åŠŸèƒ½ï¼šç±»å‹è½¬æ¢ã€é»˜è®¤å€¼ã€é…ç½®éªŒè¯
# ä¸ºä»€ä¹ˆéœ€è¦ï¼šæ›´çµæ´»çš„é…ç½®ç®¡ç†
```

#### 3. æµ‹è¯•ç¯å¢ƒä¾èµ– (testing.txt)

```txt
# requirements/testing.txt
# æµ‹è¯•ç¯å¢ƒä¸“ç”¨ä¾èµ–
# åŒ…å«æµ‹è¯•æ¡†æ¶ã€è¦†ç›–ç‡å·¥å…·ã€æµ‹è¯•æ•°æ®ç”Ÿæˆ

# ç»§æ‰¿åŸºç¡€ä¾èµ–
-r base.txt

# ============================================================================
# æµ‹è¯•æ¡†æ¶æ ¸å¿ƒ
# ============================================================================
pytest==7.4.2              # ç°ä»£Pythonæµ‹è¯•æ¡†æ¶
# ä¼˜åŠ¿ï¼šç®€æ´è¯­æ³•ã€ä¸°å¯Œæ’ä»¶ã€å¼ºå¤§æ–­è¨€ã€å‚æ•°åŒ–æµ‹è¯•
# ä¸ºä»€ä¹ˆé€‰æ‹©pytestè€Œä¸æ˜¯unittestï¼šæ›´ç®€æ´ã€æ›´å¼ºå¤§ã€æ›´å¥½çš„é”™è¯¯æŠ¥å‘Š

httpx==0.25.2              # å¼‚æ­¥HTTPå®¢æˆ·ç«¯
# åŠŸèƒ½ï¼šFastAPIæµ‹è¯•å®¢æˆ·ç«¯ã€å¼‚æ­¥è¯·æ±‚ã€HTTP/2æ”¯æŒ
# ä¸ºä»€ä¹ˆéœ€è¦ï¼šæµ‹è¯•FastAPIåº”ç”¨çš„APIç«¯ç‚¹

pytest-asyncio==0.21.1     # å¼‚æ­¥æµ‹è¯•æ”¯æŒ
# åŠŸèƒ½ï¼šasync/awaitæµ‹è¯•ã€äº‹ä»¶å¾ªç¯ç®¡ç†
# ä¸ºä»€ä¹ˆéœ€è¦ï¼šæµ‹è¯•å¼‚æ­¥ä»£ç ï¼ˆå¦‚å¼‚æ­¥æ•°æ®åº“æ“ä½œï¼‰

# ============================================================================
# æµ‹è¯•è¦†ç›–ç‡
# ============================================================================
pytest-cov==4.1.0          # æµ‹è¯•è¦†ç›–ç‡æŠ¥å‘Š
# åŠŸèƒ½ï¼šè¡Œè¦†ç›–ç‡ã€åˆ†æ”¯è¦†ç›–ç‡ã€HTMLæŠ¥å‘Šã€XMLæŠ¥å‘Š
# é…ç½®ï¼š.coveragercæ–‡ä»¶é…ç½®æ’é™¤è§„åˆ™

coverage[toml]==7.3.0      # è¦†ç›–ç‡æ ¸å¿ƒåº“
# åŠŸèƒ½ï¼šè¦†ç›–ç‡æ•°æ®æ”¶é›†ã€æŠ¥å‘Šç”Ÿæˆã€å¤šæ ¼å¼è¾“å‡º
# ä¸ºä»€ä¹ˆéœ€è¦tomlæ”¯æŒï¼šä½¿ç”¨pyproject.tomlé…ç½®

# ============================================================================
# æ¨¡æ‹Ÿå’Œå­˜æ ¹
# ============================================================================
pytest-mock==3.11.1        # æ¨¡æ‹Ÿå¯¹è±¡æ”¯æŒ
# åŠŸèƒ½ï¼šç®€åŒ–mockä½¿ç”¨ã€è‡ªåŠ¨æ¸…ç†ã€pytesté›†æˆ
# ä¸ºä»€ä¹ˆéœ€è¦ï¼šéš”ç¦»æµ‹è¯•ã€æ¨¡æ‹Ÿå¤–éƒ¨ä¾èµ–

responses==0.23.3          # HTTPè¯·æ±‚æ¨¡æ‹Ÿ
# åŠŸèƒ½ï¼šæ¨¡æ‹ŸHTTPå“åº”ã€è¯·æ±‚éªŒè¯ã€å¤šç§å“åº”ç±»å‹
# ä¸ºä»€ä¹ˆéœ€è¦ï¼šæµ‹è¯•HTTPå®¢æˆ·ç«¯ä»£ç ï¼Œé¿å…çœŸå®ç½‘ç»œè¯·æ±‚

freezegun==1.2.2           # æ—¶é—´æ¨¡æ‹Ÿ
# åŠŸèƒ½ï¼šå†»ç»“æ—¶é—´ã€æ—¶é—´æ—…è¡Œã€æ—¶åŒºå¤„ç†
# ä¸ºä»€ä¹ˆéœ€è¦ï¼šæµ‹è¯•æ—¶é—´ç›¸å…³é€»è¾‘ï¼Œç¡®ä¿æµ‹è¯•ç»“æœå¯é‡ç°

# ============================================================================
# æµ‹è¯•æ•°æ®ç”Ÿæˆ
# ============================================================================
factory-boy==3.3.0         # æµ‹è¯•æ•°æ®å·¥å‚
# åŠŸèƒ½ï¼šæ¨¡å‹å®ä¾‹ç”Ÿæˆã€å…³è”æ•°æ®ã€éšæœºæ•°æ®ã€åºåˆ—æ•°æ®
# ä¸ºä»€ä¹ˆéœ€è¦ï¼šå¿«é€Ÿç”Ÿæˆæµ‹è¯•æ•°æ®ï¼Œé¿å…æ‰‹åŠ¨åˆ›å»ºå¤æ‚å¯¹è±¡

faker==19.6.2              # å‡æ•°æ®ç”Ÿæˆ
# åŠŸèƒ½ï¼šå§“åã€åœ°å€ã€ç”µè¯ã€é‚®ç®±ç­‰å„ç§å‡æ•°æ®
# ä¸ºä»€ä¹ˆéœ€è¦ï¼šç”ŸæˆçœŸå®æ„Ÿçš„æµ‹è¯•æ•°æ®

# ============================================================================
# æ•°æ®åº“æµ‹è¯•
# ============================================================================
pytest-postgresql==5.0.0   # PostgreSQLæµ‹è¯•æ•°æ®åº“
# åŠŸèƒ½ï¼šä¸´æ—¶æ•°æ®åº“ã€è‡ªåŠ¨æ¸…ç†ã€éš”ç¦»æµ‹è¯•
# ä¸ºä»€ä¹ˆéœ€è¦ï¼šæ¯ä¸ªæµ‹è¯•ä½¿ç”¨ç‹¬ç«‹æ•°æ®åº“ï¼Œé¿å…æµ‹è¯•é—´å¹²æ‰°

sqlalchemy-utils==0.41.1   # SQLAlchemyæµ‹è¯•å·¥å…·
# åŠŸèƒ½ï¼šæ•°æ®åº“åˆ›å»º/åˆ é™¤ã€æ•°æ®ç±»å‹ã€æµ‹è¯•è¾…åŠ©å‡½æ•°
# ä¸ºä»€ä¹ˆéœ€è¦ï¼šç®€åŒ–æ•°æ®åº“æµ‹è¯•è®¾ç½®

# ============================================================================
# APIæµ‹è¯•
# ============================================================================
tavern==2.4.0              # APIæµ‹è¯•æ¡†æ¶
# åŠŸèƒ½ï¼šYAMLé…ç½®ã€HTTPæµ‹è¯•ã€å“åº”éªŒè¯ã€æµ‹è¯•é“¾
# ä¸ºä»€ä¹ˆéœ€è¦ï¼šç«¯åˆ°ç«¯APIæµ‹è¯•ï¼ŒéªŒè¯å®Œæ•´çš„è¯·æ±‚-å“åº”æµç¨‹

# ============================================================================
# æ€§èƒ½æµ‹è¯•
# ============================================================================
locust==2.16.1             # è´Ÿè½½æµ‹è¯•å·¥å…·
# åŠŸèƒ½ï¼šå¹¶å‘ç”¨æˆ·æ¨¡æ‹Ÿã€æ€§èƒ½æŒ‡æ ‡ã€Webç•Œé¢
# ä¸ºä»€ä¹ˆéœ€è¦ï¼šéªŒè¯ç³»ç»Ÿåœ¨è´Ÿè½½ä¸‹çš„è¡¨ç°

# ============================================================================
# æµ‹è¯•æŠ¥å‘Š
# ============================================================================
pytest-html==3.2.0         # HTMLæµ‹è¯•æŠ¥å‘Š
# åŠŸèƒ½ï¼šç¾è§‚çš„HTMLæŠ¥å‘Šã€æˆªå›¾æ”¯æŒã€è¯¦ç»†ä¿¡æ¯
# ä¸ºä»€ä¹ˆéœ€è¦ï¼šæ›´å¥½çš„æµ‹è¯•ç»“æœå±•ç¤º

pytest-xdist==3.3.1        # å¹¶è¡Œæµ‹è¯•
# åŠŸèƒ½ï¼šå¤šè¿›ç¨‹æµ‹è¯•ã€åˆ†å¸ƒå¼æµ‹è¯•ã€åŠ é€Ÿæµ‹è¯•æ‰§è¡Œ
# ä¸ºä»€ä¹ˆéœ€è¦ï¼šå¤§å‹é¡¹ç›®æµ‹è¯•åŠ é€Ÿ
```

#### 4. ç”Ÿäº§ç¯å¢ƒä¾èµ– (production.txt)

```txt
# requirements/production.txt
# ç”Ÿäº§ç¯å¢ƒä¸“ç”¨ä¾èµ–
# åŒ…å«ç”Ÿäº§æœåŠ¡å™¨ã€ç›‘æ§ã€æ—¥å¿—ã€æ€§èƒ½ä¼˜åŒ–å·¥å…·

# ç»§æ‰¿åŸºç¡€ä¾èµ–
-r base.txt

# ============================================================================
# ASGIæœåŠ¡å™¨
# ============================================================================
uvicorn[standard]==0.24.0  # Python ASGI HTTPæœåŠ¡å™¨
# åŠŸèƒ½ï¼šå¼‚æ­¥æ”¯æŒã€WebSocketã€HTTP/2ã€è‡ªåŠ¨é‡è½½
# é…ç½®ï¼šworkeræ•°é‡ã€è¶…æ—¶è®¾ç½®ã€æ—¥å¿—é…ç½®
# ä¸ºä»€ä¹ˆé€‰æ‹©uvicornï¼šFastAPIå®˜æ–¹æ¨èã€å¼‚æ­¥æ€§èƒ½ä¼˜ç§€

# uvicorné…ç½®ç¤ºä¾‹ï¼š
# uvicorn main:app --host 0.0.0.0 --port 8000 --workers 4
# workers = multiprocessing.cpu_count() * 2 + 1
# worker_class = "uvicorn.workers.UvicornWorker"  # å¦‚æœä½¿ç”¨gunicornä½œä¸ºè¿›ç¨‹ç®¡ç†å™¨
# worker_connections = 1000
# timeout = 30
# keepalive = 2

# ============================================================================
# å¼‚æ­¥å¤„ç†
# ============================================================================
# FastAPIåŸç”Ÿæ”¯æŒå¼‚æ­¥ï¼Œæ— éœ€é¢å¤–çš„å¼‚æ­¥åº“
# ä½¿ç”¨PythonåŸç”Ÿçš„asyncioå’Œasync/awaitè¯­æ³•
# ä¼˜åŠ¿ï¼šæ›´å¥½çš„æ€§èƒ½ã€æ›´ç®€æ´çš„ä»£ç ã€æ›´å¥½çš„è°ƒè¯•æ”¯æŒ

# ============================================================================
# æ•°æ®åº“è¿æ¥æ± 
# ============================================================================
psycopg2==2.9.7            # PostgreSQLé©±åŠ¨ï¼ˆæºç ç¼–è¯‘ç‰ˆï¼‰
# ä¸ºä»€ä¹ˆåœ¨ç”Ÿäº§ç¯å¢ƒä½¿ç”¨psycopg2è€Œä¸æ˜¯psycopg2-binaryï¼Ÿ
# 1. æ€§èƒ½ï¼šæºç ç¼–è¯‘ç‰ˆæœ¬æ€§èƒ½æ›´ä¼˜
# 2. å®‰å…¨ï¼šé¿å…äºŒè¿›åˆ¶åŒ…çš„æ½œåœ¨å®‰å…¨é£é™©
# 3. å…¼å®¹æ€§ï¼šæ›´å¥½çš„ç³»ç»Ÿå…¼å®¹æ€§

SQLAlchemy[postgresql_psycopg2]==2.0.21  # åŒ…å«PostgreSQLä¼˜åŒ–

# ============================================================================
# ç¼“å­˜ä¼˜åŒ–
# ============================================================================
aioredis==2.0.1            # å¼‚æ­¥Rediså®¢æˆ·ç«¯
# åŠŸèƒ½ï¼šå¼‚æ­¥Redisæ“ä½œã€è¿æ¥æ± ã€é›†ç¾¤æ”¯æŒ
# ä¸ºä»€ä¹ˆéœ€è¦ï¼šä¸FastAPIå¼‚æ­¥ç‰¹æ€§å®Œç¾é…åˆï¼Œé¿å…é˜»å¡

# ============================================================================
# ç›‘æ§å’ŒæŒ‡æ ‡
# ============================================================================
prometheus-client==0.17.1  # Prometheusç›‘æ§å®¢æˆ·ç«¯
# åŠŸèƒ½ï¼šæŒ‡æ ‡æ”¶é›†ã€HTTPç«¯ç‚¹æš´éœ²ã€è‡ªå®šä¹‰æŒ‡æ ‡
# ä¸ºä»€ä¹ˆéœ€è¦ï¼šåº”ç”¨æ€§èƒ½ç›‘æ§ã€å‘Šè­¦æ”¯æŒ

statsd==4.0.1              # StatsDå®¢æˆ·ç«¯
# åŠŸèƒ½ï¼šæŒ‡æ ‡å‘é€ã€è®¡æ•°å™¨ã€è®¡æ—¶å™¨ã€ä»ªè¡¨ç›˜
# ä¸ºä»€ä¹ˆéœ€è¦ï¼šå®æ—¶æŒ‡æ ‡æ”¶é›†

# ============================================================================
# æ—¥å¿—å¤„ç†
# ============================================================================
structlog==23.1.0          # ç»“æ„åŒ–æ—¥å¿—
# åŠŸèƒ½ï¼šJSONæ—¥å¿—ã€ä¸Šä¸‹æ–‡ä¿¡æ¯ã€æ—¥å¿—å¤„ç†å™¨é“¾
# ä¸ºä»€ä¹ˆéœ€è¦ï¼šä¾¿äºæ—¥å¿—åˆ†æå’Œç›‘æ§ç³»ç»Ÿé›†æˆ

python-json-logger==2.0.7  # JSONæ ¼å¼æ—¥å¿—
# åŠŸèƒ½ï¼šJSONæ ¼å¼è¾“å‡ºã€å­—æ®µå®šåˆ¶ã€æ€§èƒ½ä¼˜åŒ–
# ä¸ºä»€ä¹ˆéœ€è¦ï¼šæ—¥å¿—èšåˆç³»ç»Ÿï¼ˆå¦‚ELKï¼‰é›†æˆ

# ============================================================================
# å®‰å…¨å¢å¼º
# ============================================================================
cryptography>=41.0.0       # åŠ å¯†åº“ï¼ˆæœ€æ–°å®‰å…¨ç‰ˆæœ¬ï¼‰
# åŠŸèƒ½ï¼šåŠ å¯†è§£å¯†ã€æ•°å­—ç­¾åã€è¯ä¹¦å¤„ç†
# ä¸ºä»€ä¹ˆä½¿ç”¨æœ€å°ç‰ˆæœ¬ï¼šç¡®ä¿å®‰å…¨æ¼æ´å·²ä¿®å¤

python-jose[cryptography]==3.3.0  # JWTåº“ï¼ˆFastAPIæ¨èï¼‰
# cryptographyæ‰©å±•ï¼šæ”¯æŒRSAã€ECDSAç­‰åŠ å¯†ç®—æ³•
# ä¸ºä»€ä¹ˆé€‰æ‹©ï¼šFastAPIå®˜æ–¹æ¨èï¼Œæ›´å¥½çš„å¼‚æ­¥æ”¯æŒ

# ============================================================================
# æ€§èƒ½ä¼˜åŒ–
# ============================================================================
ujson==5.8.0               # å¿«é€ŸJSONå¤„ç†
# åŠŸèƒ½ï¼šCå®ç°çš„JSONç¼–è§£ç ï¼Œæ€§èƒ½æ¯”æ ‡å‡†åº“å¿«æ•°å€
# ä¸ºä»€ä¹ˆéœ€è¦ï¼šAPIå“åº”æ€§èƒ½ä¼˜åŒ–

orjson==3.9.5              # æ›´å¿«çš„JSONåº“
# åŠŸèƒ½ï¼šRustå®ç°ï¼Œæ¯”ujsonæ›´å¿«
# ä¸ºä»€ä¹ˆæä¾›ï¼šæŸäº›åœºæ™¯ä¸‹orjsonæ€§èƒ½æ›´ä¼˜

# ============================================================================
# HTTPå®¢æˆ·ç«¯ä¼˜åŒ–
# ============================================================================
httpx==0.24.1              # ç°ä»£HTTPå®¢æˆ·ç«¯
# åŠŸèƒ½ï¼šå¼‚æ­¥æ”¯æŒã€HTTP/2ã€è¿æ¥æ± ã€è¶…æ—¶æ§åˆ¶
# ä¸ºä»€ä¹ˆéœ€è¦ï¼šæ›¿ä»£requestsï¼Œæ”¯æŒå¼‚æ­¥å’ŒHTTP/2

# ============================================================================
# è¿›ç¨‹ç®¡ç†
# ============================================================================
supervisor==4.2.5          # è¿›ç¨‹ç›‘æ§å’Œç®¡ç†
# åŠŸèƒ½ï¼šè¿›ç¨‹å¯åŠ¨ã€é‡å¯ã€ç›‘æ§ã€æ—¥å¿—ç®¡ç†
# ä¸ºä»€ä¹ˆéœ€è¦ï¼šç¡®ä¿åº”ç”¨è¿›ç¨‹ç¨³å®šè¿è¡Œ

# ============================================================================
# å¥åº·æ£€æŸ¥
# ============================================================================
# FastAPIå†…ç½®å¥åº·æ£€æŸ¥æ”¯æŒï¼Œæ— éœ€é¢å¤–ä¾èµ–
# å¯é€šè¿‡ç®€å•çš„è·¯ç”±å®ç°ï¼š@app.get("/health")
# åŠŸèƒ½ï¼šè‡ªå®šä¹‰å¥åº·æ£€æŸ¥é€»è¾‘ã€ä¾èµ–æ£€æŸ¥ã€è´Ÿè½½å‡è¡¡å™¨é›†æˆ
```

## ä¾èµ–ç‰ˆæœ¬ç®¡ç†ç­–ç•¥

### è¯­ä¹‰åŒ–ç‰ˆæœ¬æ§åˆ¶ç†è§£

```
ç‰ˆæœ¬å·æ ¼å¼ï¼šä¸»ç‰ˆæœ¬.æ¬¡ç‰ˆæœ¬.ä¿®è®¢ç‰ˆæœ¬
ä¾‹å¦‚ï¼šFastAPI 0.104.1

ä¸»ç‰ˆæœ¬(0)ï¼š
- FastAPIä»åœ¨0.xç‰ˆæœ¬ï¼Œè¡¨ç¤ºAPIå¯èƒ½æœ‰å˜åŒ–
- é‡å¤§æ¶æ„å˜æ›´
- å¯èƒ½éœ€è¦ä»£ç ä¿®æ”¹
- ç¤ºä¾‹ï¼šæœªæ¥çš„FastAPI 0.x â†’ 1.x

æ¬¡ç‰ˆæœ¬(104)ï¼š
- å‘åå…¼å®¹çš„åŠŸèƒ½æ€§æ–°å¢
- æ–°ç‰¹æ€§å’Œæ”¹è¿›
- ä¸ç ´åç°æœ‰API
- ç¤ºä¾‹ï¼šFastAPI 0.103 â†’ 0.104

ä¿®è®¢ç‰ˆæœ¬(1)ï¼š
- å‘åå…¼å®¹çš„é—®é¢˜ä¿®æ­£
- Bugä¿®å¤å’Œå®‰å…¨æ›´æ–°
- ä¸æ”¹å˜API
- ç¤ºä¾‹ï¼šFastAPI 0.104.0 â†’ 0.104.1
```

### ç‰ˆæœ¬çº¦æŸç­–ç•¥è¯¦è§£

#### 1. æ ¸å¿ƒæ¡†æ¶ä½¿ç”¨ç²¾ç¡®ç‰ˆæœ¬

```txt
# ä¸ºä»€ä¹ˆFastAPIä½¿ç”¨ç²¾ç¡®ç‰ˆæœ¬ï¼Ÿ
fastapi==0.104.1

åŸå› åˆ†æï¼š
1. APIç¨³å®šæ€§ï¼šFastAPIçš„APIå˜æ›´å¯èƒ½å½±å“æ•´ä¸ªåº”ç”¨
2. è¡Œä¸ºä¸€è‡´æ€§ï¼šç¡®ä¿æ‰€æœ‰ç¯å¢ƒçš„FastAPIè¡Œä¸ºå®Œå…¨ä¸€è‡´
3. è°ƒè¯•ä¾¿åˆ©æ€§ï¼šé—®é¢˜å¤ç°å’Œè°ƒè¯•æ›´å®¹æ˜“
4. éƒ¨ç½²å®‰å…¨æ€§ï¼šé¿å…ç”Ÿäº§ç¯å¢ƒæ„å¤–å‡çº§
5. 0.xç‰ˆæœ¬ç‰¹æ€§ï¼šFastAPIä»åœ¨å¿«é€Ÿå‘å±•ï¼Œç²¾ç¡®ç‰ˆæœ¬æ›´å®‰å…¨

é£é™©æ§åˆ¶ï¼š
- å®šæœŸè¯„ä¼°æ–°ç‰ˆæœ¬
- åœ¨æµ‹è¯•ç¯å¢ƒéªŒè¯å‡çº§
- åˆ¶å®šå‡çº§è®¡åˆ’å’Œå›æ»šç­–ç•¥
- å…³æ³¨FastAPIçš„å˜æ›´æ—¥å¿—
```

#### 2. å·¥å…·åº“ä½¿ç”¨å…¼å®¹ç‰ˆæœ¬

```txt
# ä¸ºä»€ä¹ˆrequestsä½¿ç”¨å…¼å®¹ç‰ˆæœ¬ï¼Ÿ
requests~=2.31.0  # ç­‰ä»·äº >=2.31.0,<2.32.0

åŸå› åˆ†æï¼š
1. APIç¨³å®šï¼šrequestsçš„APIéå¸¸ç¨³å®šï¼Œè¡¥ä¸ç‰ˆæœ¬å¾ˆå°‘ç ´åå…¼å®¹æ€§
2. å®‰å…¨é‡è¦ï¼šHTTPåº“éœ€è¦åŠæ—¶çš„å®‰å…¨æ›´æ–°
3. Bugä¿®å¤ï¼šè‡ªåŠ¨è·å¾—bugä¿®å¤ï¼Œæé«˜ç¨³å®šæ€§
4. ç»´æŠ¤æˆæœ¬ï¼šå‡å°‘æ‰‹åŠ¨ç‰ˆæœ¬ç®¡ç†çš„å·¥ä½œé‡

é€‚ç”¨æ¡ä»¶ï¼š
- åº“çš„APIç¨³å®šä¸”æˆç†Ÿ
- å®‰å…¨æ›´æ–°é¢‘ç¹
- è¡¥ä¸ç‰ˆæœ¬å…¼å®¹æ€§å¥½
```

#### 3. å¿«é€Ÿå‘å±•çš„åº“ä½¿ç”¨èŒƒå›´ç‰ˆæœ¬

```txt
# ä¸ºä»€ä¹ˆSQLAlchemyä½¿ç”¨èŒƒå›´ç‰ˆæœ¬ï¼Ÿ
SQLAlchemy>=2.0.0,<3.0.0

åŸå› åˆ†æï¼š
1. åŠŸèƒ½ä¸°å¯Œï¼š2.xç‰ˆæœ¬æŒç»­å¢åŠ æœ‰ç”¨çš„æ–°åŠŸèƒ½
2. æ€§èƒ½ä¼˜åŒ–ï¼šæ–°ç‰ˆæœ¬é€šå¸¸æœ‰æ€§èƒ½æ”¹è¿›
3. ä¸»ç‰ˆæœ¬ç¨³å®šï¼š2.xå†…éƒ¨APIç›¸å¯¹ç¨³å®š
4. ç¤¾åŒºæ´»è·ƒï¼šbugä¿®å¤å’Œæ”¹è¿›é¢‘ç¹

æ³¨æ„äº‹é¡¹ï¼š
- å®šæœŸæµ‹è¯•æ–°ç‰ˆæœ¬å…¼å®¹æ€§
- å…³æ³¨å˜æ›´æ—¥å¿—
- åœ¨æµ‹è¯•ç¯å¢ƒå…ˆéªŒè¯
```

#### 4. å®‰å…¨åº“ä½¿ç”¨æœ€å°ç‰ˆæœ¬

```txt
# ä¸ºä»€ä¹ˆcryptographyä½¿ç”¨æœ€å°ç‰ˆæœ¬ï¼Ÿ
cryptography>=41.0.0

åŸå› åˆ†æï¼š
1. å®‰å…¨å…³é”®ï¼šåŠ å¯†åº“çš„å®‰å…¨æ¼æ´å½±å“ä¸¥é‡
2. å¿«é€Ÿä¿®å¤ï¼šå®‰å…¨é—®é¢˜éœ€è¦å¿«é€Ÿä¿®å¤
3. å‘åå…¼å®¹ï¼šé€šå¸¸ä¿æŒAPIå…¼å®¹æ€§
4. åˆè§„è¦æ±‚ï¼šæŸäº›å®‰å…¨æ ‡å‡†è¦æ±‚æœ€æ–°ç‰ˆæœ¬

ç®¡ç†ç­–ç•¥ï¼š
- å®šæœŸæ£€æŸ¥å®‰å…¨å…¬å‘Š
- åŠæ—¶æ›´æ–°åˆ°å®‰å…¨ç‰ˆæœ¬
- æµ‹è¯•å‡çº§å¯¹åº”ç”¨çš„å½±å“
```

## ä¾èµ–å†²çªè§£å†³

### å†²çªæ£€æµ‹å·¥å…·

#### 1. pip-toolsä½¿ç”¨

```bash
# å®‰è£…pip-tools
pip install pip-tools

# åˆ›å»ºrequirements.inæ–‡ä»¶ï¼ˆé«˜çº§ä¾èµ–æè¿°ï¼‰
# requirements.in
fastapi>=0.104.0
SQLAlchemy>=2.0.0
uvicorn[standard]
httpx

# ç”Ÿæˆé”å®šç‰ˆæœ¬çš„requirements.txt
pip-compile requirements.in

# è¾“å‡ºç¤ºä¾‹ï¼š
# This file is autogenerated by pip-compile with Python 3.11
# To update, run:
#
#    pip-compile requirements.in
#
anyio==4.0.0
    # via
    #   httpx
    #   starlette
fastapi==0.104.1
    # via -r requirements.in
httpx==0.25.2
    # via -r requirements.in
pydantic==2.5.0
    # via
    #   fastapi
    #   pydantic-core
sqlalchemy==2.0.21
    # via -r requirements.in
starlette==0.27.0
    # via fastapi
uvicorn[standard]==0.24.0
    # via -r requirements.in
```

#### 2. ä¾èµ–å…³ç³»åˆ†æ

```bash
# æŸ¥çœ‹ä¾èµ–æ ‘
pip install pipdeptree
pipdeptree

# è¾“å‡ºç¤ºä¾‹ï¼š
fastapi==0.104.1
â”œâ”€â”€ pydantic [required: >=1.7.4,!=1.8,!=1.8.1,!=2.0.0,!=2.0.1,!=2.1.0,<3.0.0, installed: 2.5.0]
â”‚   â”œâ”€â”€ annotated-types [required: >=0.4.0, installed: 0.6.0]
â”‚   â”œâ”€â”€ pydantic-core [required: ==2.14.5, installed: 2.14.5]
â”‚   â””â”€â”€ typing-extensions [required: >=4.6.1, installed: 4.8.0]
â”œâ”€â”€ starlette [required: <0.28.0,>=0.27.0, installed: 0.27.0]
â”‚   â””â”€â”€ anyio [required: >=3.4.0,<5, installed: 4.0.0]
â””â”€â”€ typing-extensions [required: >=4.8.0, installed: 4.8.0]

uvicorn[standard]==0.24.0
â”œâ”€â”€ click [required: >=7.0, installed: 8.1.7]
â”œâ”€â”€ h11 [required: >=0.8, installed: 0.14.0]
â””â”€â”€ typing-extensions [required: >=4.0, installed: 4.8.0]

# æ£€æŸ¥å†²çª
pipdeptree --warn conflict

# å¦‚æœæœ‰å†²çªï¼Œä¼šæ˜¾ç¤ºï¼š
# Warning!!! Possible conflicting dependencies found:
# * package-a==1.0 [required: >=2.0 by package-b]
```

### å¸¸è§å†²çªåœºæ™¯å’Œè§£å†³æ–¹æ¡ˆ

#### 1. python-joseå’Œcryptographyç‰ˆæœ¬å†²çª

```txt
# é—®é¢˜åœºæ™¯ï¼š
python-jose[cryptography]==3.3.0  # éœ€è¦ cryptography>=3.4.0
æŸä¸ªå…¶ä»–åº“éœ€è¦ cryptography==3.2.0

# é”™è¯¯ä¿¡æ¯ï¼š
# ERROR: python-jose 3.3.0 has requirement cryptography>=3.4.0, 
# but you'll have cryptography 3.2.0 which is incompatible.

# è§£å†³æ–¹æ¡ˆ1ï¼šå‡çº§ä¾èµ–
python-jose[cryptography]==3.3.0
cryptography==41.0.0  # ä½¿ç”¨å…¼å®¹çš„æ–°ç‰ˆæœ¬

# è§£å†³æ–¹æ¡ˆ2ï¼šä½¿ç”¨ä¸åŒçš„joseå®ç°
# å¦‚æœcryptographyç‰ˆæœ¬æ— æ³•å‡çº§
python-jose==3.3.0  # ä¸åŒ…å«cryptographyæ‰©å±•
PyJWT==2.8.0  # ä½¿ç”¨PyJWTä½œä¸ºæ›¿ä»£

# è§£å†³æ–¹æ¡ˆ3ï¼šç‰ˆæœ¬èŒƒå›´åè°ƒ
python-jose[cryptography]>=3.2.0,<3.4.0
cryptography>=3.2.0,<4.0.0  # æ‰¾åˆ°å…¼å®¹çš„ç‰ˆæœ¬èŒƒå›´
```

#### 2. SQLAlchemyç‰ˆæœ¬å…¼å®¹æ€§é—®é¢˜

```txt
# é—®é¢˜åœºæ™¯ï¼š
SQLAlchemy==2.0.23        # æ–°ç‰ˆæœ¬
fastapi==0.104.1          # éœ€è¦ä¸SQLAlchemy 2.xå…¼å®¹

# è§£å†³æ–¹æ¡ˆï¼šä½¿ç”¨å…¼å®¹ç‰ˆæœ¬
SQLAlchemy==2.0.23
fastapi==0.104.1          # FastAPIåŸç”Ÿæ”¯æŒSQLAlchemy 2.x
alembic==1.12.1           # æ•°æ®åº“è¿ç§»å·¥å…·

# æˆ–è€…ä¿æŒæ—§ç‰ˆæœ¬å…¼å®¹
SQLAlchemy==1.4.48
fastapi==0.95.0           # è¾ƒæ—©ç‰ˆæœ¬çš„FastAPI
```

#### 3. å¼€å‘å·¥å…·å†²çª

```txt
# é—®é¢˜åœºæ™¯ï¼š
black==23.7.0     # éœ€è¦ click>=8.0.0
fastapi==0.104.1  # ä¸ç›´æ¥ä¾èµ–click
uvicorn==0.24.0   # éœ€è¦ click>=7.0
æŸä¸ªCLIå·¥å…·éœ€è¦ click==7.1.2

# è§£å†³æ–¹æ¡ˆï¼šæ‰¾åˆ°å…¼å®¹èŒƒå›´
black==23.7.0
fastapi==0.104.1  # FastAPIä¸ç›´æ¥ä¾èµ–click
uvicorn==0.24.0   # æ›´æ–°uvicornç‰ˆæœ¬
click==8.1.7      # æ»¡è¶³æ‰€æœ‰è¦æ±‚çš„ç‰ˆæœ¬
```

### å†²çªé¢„é˜²ç­–ç•¥

#### 1. å®šæœŸä¾èµ–å®¡è®¡

```python
# scripts/audit_dependencies.py
"""ä¾èµ–å®¡è®¡è„šæœ¬"""

import subprocess
import sys
from packaging import version
import pkg_resources

def check_outdated_packages():
    """æ£€æŸ¥è¿‡æ—¶çš„åŒ…"""
    result = subprocess.run(
        [sys.executable, '-m', 'pip', 'list', '--outdated', '--format=json'],
        capture_output=True, text=True
    )
    
    if result.returncode == 0:
        import json
        outdated = json.loads(result.stdout)
        if outdated:
            print("ğŸ“¦ è¿‡æ—¶çš„åŒ…ï¼š")
            for pkg in outdated:
                print(f"  {pkg['name']}: {pkg['version']} â†’ {pkg['latest_version']}")
        else:
            print("âœ… æ‰€æœ‰åŒ…éƒ½æ˜¯æœ€æ–°çš„")
    else:
        print(f"âŒ æ£€æŸ¥å¤±è´¥: {result.stderr}")

def check_security_vulnerabilities():
    """æ£€æŸ¥å®‰å…¨æ¼æ´"""
    try:
        result = subprocess.run(
            [sys.executable, '-m', 'pip', 'audit'],
            capture_output=True, text=True
        )
        
        if result.returncode == 0:
            if "No known vulnerabilities found" in result.stdout:
                print("ğŸ”’ æœªå‘ç°å®‰å…¨æ¼æ´")
            else:
                print("âš ï¸  å‘ç°å®‰å…¨æ¼æ´ï¼š")
                print(result.stdout)
        else:
            print(f"âŒ å®‰å…¨æ£€æŸ¥å¤±è´¥: {result.stderr}")
    except FileNotFoundError:
        print("âš ï¸  pip auditä¸å¯ç”¨ï¼Œè¯·å‡çº§pipåˆ°æœ€æ–°ç‰ˆæœ¬")

if __name__ == '__main__':
    print("ğŸ” ä¾èµ–å®¡è®¡æŠ¥å‘Š")
    print("=" * 50)
    check_outdated_packages()
    print()
    check_security_vulnerabilities()
```

#### 2. è‡ªåŠ¨åŒ–ä¾èµ–æ›´æ–°

```bash
# scripts/update_dependencies.sh
# ä¾èµ–æ›´æ–°è„šæœ¬

echo "ğŸ”„ å¼€å§‹ä¾èµ–æ›´æ–°æµç¨‹"

# 1. å¤‡ä»½å½“å‰ä¾èµ–
cp requirements.txt requirements.txt.backup
echo "âœ… å·²å¤‡ä»½å½“å‰ä¾èµ–æ–‡ä»¶"

# 2. æ›´æ–°pip-tools
pip install --upgrade pip-tools

# 3. é‡æ–°ç¼–è¯‘ä¾èµ–
echo "ğŸ“¦ é‡æ–°ç¼–è¯‘ä¾èµ–..."
pip-compile --upgrade requirements.in

# 4. æ£€æŸ¥å†²çª
echo "ğŸ” æ£€æŸ¥ä¾èµ–å†²çª..."
pipdeptree --warn conflict

# 5. è¿è¡Œæµ‹è¯•
echo "ğŸ§ª è¿è¡Œæµ‹è¯•éªŒè¯..."
pytest tests/ -v

if [ $? -eq 0 ]; then
    echo "âœ… ä¾èµ–æ›´æ–°æˆåŠŸï¼Œæµ‹è¯•é€šè¿‡"
    rm requirements.txt.backup
else
    echo "âŒ æµ‹è¯•å¤±è´¥ï¼Œæ¢å¤åŸä¾èµ–"
    mv requirements.txt.backup requirements.txt
    pip-sync requirements.txt
fi
```

## åœ¨äººåŠ›èµ„æºè°ƒåº¦ç³»ç»Ÿä¸­çš„å®è·µ

### é¡¹ç›®ä¾èµ–ç®¡ç†å®ä¾‹

```bash
# äººåŠ›èµ„æºè°ƒåº¦ç³»ç»Ÿçš„ä¾èµ–ç®¡ç†ç»“æ„
hr_scheduling/
â”œâ”€â”€ requirements/
â”‚   â”œâ”€â”€ base.txt              # æ ¸å¿ƒè¿è¡Œä¾èµ–
â”‚   â”œâ”€â”€ development.txt       # å¼€å‘ç¯å¢ƒä¾èµ–
â”‚   â”œâ”€â”€ testing.txt          # æµ‹è¯•ç¯å¢ƒä¾èµ–
â”‚   â”œâ”€â”€ production.txt       # ç”Ÿäº§ç¯å¢ƒä¾èµ–
â”‚   â””â”€â”€ optional.txt         # å¯é€‰åŠŸèƒ½ä¾èµ–
â”œâ”€â”€ requirements.txt         # é»˜è®¤ä¾èµ–ï¼ˆæŒ‡å‘production.txtï¼‰
â”œâ”€â”€ requirements.in          # é«˜çº§ä¾èµ–æè¿°
â”œâ”€â”€ .python-version         # Pythonç‰ˆæœ¬é”å®š
â””â”€â”€ pyproject.toml          # é¡¹ç›®é…ç½®å’Œä¾èµ–
```

### ç¯å¢ƒç‰¹å®šçš„ä¾èµ–å®‰è£…

```bash
# å¼€å‘ç¯å¢ƒè®¾ç½®
python -m venv venv
venv\Scripts\activate
pip install --upgrade pip
pip install -r requirements/development.txt

# æµ‹è¯•ç¯å¢ƒè®¾ç½®
pip install -r requirements/testing.txt

# ç”Ÿäº§ç¯å¢ƒè®¾ç½®
pip install -r requirements/production.txt

# éªŒè¯å®‰è£…
python scripts/check_environment.py
```

### æŒç»­é›†æˆä¸­çš„ä¾èµ–ç®¡ç†

```yaml
# .github/workflows/ci.yml
name: CI

on: [push, pull_request]

jobs:
  test:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        python-version: [3.9, 3.10, 3.11]
    
    steps:
    - uses: actions/checkout@v3
    
    - name: Set up Python ${{ matrix.python-version }}
      uses: actions/setup-python@v4
      with:
        python-version: ${{ matrix.python-version }}
    
    - name: Cache pip dependencies
      uses: actions/cache@v3
      with:
        path: ~/.cache/pip
        key: ${{ runner.os }}-pip-${{ hashFiles('requirements/testing.txt') }}
        restore-keys: |
          ${{ runner.os }}-pip-
    
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements/testing.txt
    
    - name: Check dependency conflicts
      run: |
        pip install pipdeptree
        pipdeptree --warn conflict
    
    - name: Run tests
      run: |
        pytest tests/ --cov=app --cov-report=xml
    
    - name: Upload coverage
      uses: codecov/codecov-action@v3
      with:
        file: ./coverage.xml
```

## æ€»ç»“

ä¾èµ–ç®¡ç†æ˜¯Pythonåç«¯å¼€å‘çš„åŸºç¡€ï¼Œè‰¯å¥½çš„ä¾èµ–ç®¡ç†ç­–ç•¥åŒ…æ‹¬ï¼š

1. **ç²¾ç¡®çš„ç‰ˆæœ¬æ§åˆ¶**ï¼šä½¿ç”¨requirements.txté”å®šç‰ˆæœ¬
2. **åˆ†å±‚çš„ä¾èµ–ç®¡ç†**ï¼šä¸åŒç¯å¢ƒä½¿ç”¨ä¸åŒçš„ä¾èµ–é›†åˆ
3. **åˆç†çš„ç‰ˆæœ¬çº¦æŸ**ï¼šæ ¹æ®åº“çš„ç‰¹æ€§é€‰æ‹©åˆé€‚çš„ç‰ˆæœ¬çº¦æŸç­–ç•¥
4. **ä¸»åŠ¨çš„å†²çªè§£å†³**ï¼šä½¿ç”¨å·¥å…·æ£€æµ‹å’Œè§£å†³ä¾èµ–å†²çª
5. **å®šæœŸçš„ä¾èµ–å®¡è®¡**ï¼šæ£€æŸ¥è¿‡æ—¶åŒ…å’Œå®‰å…¨æ¼æ´
6. **è‡ªåŠ¨åŒ–çš„æ›´æ–°æµç¨‹**ï¼šå‡å°‘æ‰‹åŠ¨ç®¡ç†çš„å·¥ä½œé‡

åœ¨äººåŠ›èµ„æºè°ƒåº¦ç³»ç»Ÿçš„å¼€å‘ä¸­ï¼Œåˆç†çš„ä¾èµ–ç®¡ç†å¯ä»¥ï¼š
- ç¡®ä¿å¼€å‘ã€æµ‹è¯•ã€ç”Ÿäº§ç¯å¢ƒçš„ä¸€è‡´æ€§
- æé«˜ç³»ç»Ÿçš„ç¨³å®šæ€§å’Œå®‰å…¨æ€§
- ç®€åŒ–éƒ¨ç½²å’Œè¿ç»´æµç¨‹
- é™ä½ç»´æŠ¤æˆæœ¬å’Œé£é™©
- æ”¯æŒå›¢é˜Ÿåä½œå’Œä»£ç å…±äº«

é€šè¿‡æ·±å…¥ç†è§£ä¾èµ–ç®¡ç†çš„åŸç†å’Œæœ€ä½³å®è·µï¼Œæˆ‘ä»¬å¯ä»¥æ„å»ºæ›´åŠ å¯é å’Œå¯ç»´æŠ¤çš„Pythonåç«¯åº”ç”¨ã€‚